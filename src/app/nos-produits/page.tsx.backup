'use client';

import { useState, useMemo } from 'react';
import Header from '@/components/Header';
import ProductCard from '@/components/ProductCard';
import Sidebar from '@/components/Sidebar';
import { Product } from '@/types';
import { Search, Filter, Grid3X3, List, Menu } from 'lucide-react';
import { motion } from 'framer-motion';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';

export default function SmartphonesPage() {
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedBrand, setSelectedBrand] = useState<string>('');
  const [selectedCategory, setSelectedCategory] = useState<string>('');
  const [selectedProduct, setSelectedProduct] = useState<string>('');
  const [sortBy, setSortBy] = useState<string>('name');
  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');
  const [sidebarOpen, setSidebarOpen] = useState(false);

  // Données mock étendues pour la collection
  const products: Product[] = [
    {
      id: '1',
      'Nom du Produit': 'MUVIT Casque Enfant Dragon',
      'Marque': 'MUVIT',
      'Catégorie': 'Casques Enfant',
      'SKU': 'MUVIT-CASQUE-DRAGON',
      'Description SEO': 'Casque audio pour enfant MUVIT avec design Dragon amusant. Confortable et sécurisé avec limitation de volume.',
      'Meta Title': 'Casque Enfant MUVIT Dragon',
      'Meta Description': 'Casque enfant MUVIT Dragon avec protection auditive',
      'URL Slug': 'casque-enfant-muvit-dragon',
      'Mots-clés SEO': 'casque enfant, MUVIT, dragon',
      'Images GitHub': 'https://raw.githubusercontent.com/Alexlehoux974/Monster-Phone-Images/main/MUVIT/Images/Casques-Enfant/Dragon/CASQUE_DRAGON.jpg',
      'Variantes/Couleurs': 'Dragon (vert/rouge)',
      'Prix': 49.99,
      'Statut Publication': 'Publié'
    },
    {
      id: '2',
      'Nom du Produit': 'MY-WAY Câble USB-C Lightning Lumineux',
      'Marque': 'MY WAY',
      'Catégorie': 'Câbles de Chargement',
      'SKU': 'MYWAY-USB-C-LIGHTNING',
      'Description SEO': 'Câble USB-C vers Lightning MY-WAY avec éclairage LED premium. Charge ultra-rapide pour iPhone.',
      'Meta Title': 'Câble USB-C Lightning MY-WAY Lumineux',
      'Meta Description': 'Câble USB-C Lightning MY-WAY avec LED',
      'URL Slug': 'myway-cable-usb-c-lightning-lumineux',
      'Mots-clés SEO': 'câble USB-C lightning, MY-WAY',
      'Images GitHub': 'https://raw.githubusercontent.com/Alexlehoux974/Monster-Phone-Images/main/MY-WAY/Images/Cables-Lumineux/USB-C-Lightning/CABLE_USB-C_LIGHTNING.jpg',
      'Variantes/Couleurs': 'Blanc avec LED',
      'Prix': 29.99,
      'Statut Publication': 'Publié'
    },
    {
      id: '3',
      'Nom du Produit': 'HONOR 200 PRO Smartphone',
      'Marque': 'HONOR',
      'Catégorie': 'Smartphones',
      'SKU': 'HONOR-200-PRO',
      'Description SEO': 'Smartphone HONOR 200 PRO avec caméras professionnelles et performance flagship.',
      'Meta Title': 'HONOR 200 PRO - Smartphone Flagship',
      'Meta Description': 'HONOR 200 PRO smartphone premium',
      'URL Slug': 'honor-200-pro-smartphone-flagship',
      'Mots-clés SEO': 'HONOR 200 PRO, smartphone flagship',
      'Images GitHub': 'https://raw.githubusercontent.com/Alexlehoux974/Monster-Phone-Images/main/HONOR/Images/200-Pro/HONOR_200_PRO.png',
      'Variantes/Couleurs': 'Black, Moonlight White, Ocean Cyan',
      'Prix': 799.99,
      'Statut Publication': 'Publié'
    },
    {
      id: '4',
      'Nom du Produit': 'MONSTER N-Lite 206 Batterie Portable',
      'Marque': 'MONSTER',
      'Catégorie': 'Batteries Portables',
      'SKU': 'MONSTER-N-LITE-206',
      'Description SEO': 'Batterie portable MONSTER N-Lite 206 haute capacité. Design compact et léger.',
      'Meta Title': 'MONSTER N-Lite 206 - Batterie Portable',
      'Meta Description': 'Batterie portable MONSTER N-Lite 206',
      'URL Slug': 'monster-n-lite-206-batterie-portable',
      'Mots-clés SEO': 'batterie portable, MONSTER N-Lite 206',
      'Images GitHub': 'https://raw.githubusercontent.com/Alexlehoux974/Monster-Phone-Images/main/MONSTER/Images/N-Lite-206/N_LITE_206.jpeg',
      'Variantes/Couleurs': 'Noir mat premium',
      'Prix': 89.99,
      'Statut Publication': 'Publié'
    },
    {
      id: '5',
      'Nom du Produit': 'MUVIT Coque Protection Transparente',
      'Marque': 'MUVIT',
      'Catégorie': 'Coques Protection',
      'SKU': 'MUVIT-COQUE-TRANSPARENT',
      'Description SEO': 'Coque de protection transparente MUVIT. Design minimaliste avec protection renforcée.',
      'Meta Title': 'Coque MUVIT Transparente Premium',
      'Meta Description': 'Coque protection transparente MUVIT',
      'URL Slug': 'muvit-coque-protection-transparente',
      'Mots-clés SEO': 'coque transparente, MUVIT, protection',
      'Images GitHub': 'https://raw.githubusercontent.com/Alexlehoux974/Monster-Phone-Images/main/MUVIT/Images/Coques/Transparente/COQUE_TRANSPARENT.jpg',
      'Variantes/Couleurs': 'Transparent crystal',
      'Prix': 19.99,
      'Statut Publication': 'Publié'
    },
    {
      id: '6',
      'Nom du Produit': 'HIFUTURE Smartwatch Sport Pro',
      'Marque': 'HIFUTURE',
      'Catégorie': 'Montres Connectées',
      'SKU': 'HIFUTURE-SMARTWATCH-SPORT',
      'Description SEO': 'Montre connectée HIFUTURE Sport Pro. Suivi sportif avancé et autonomie 7 jours.',
      'Meta Title': 'HIFUTURE Smartwatch Sport Pro',
      'Meta Description': 'Smartwatch HIFUTURE Sport Pro autonomie 7j',
      'URL Slug': 'hifuture-smartwatch-sport-pro',
      'Mots-clés SEO': 'smartwatch, HIFUTURE, sport',
      'Images GitHub': 'https://raw.githubusercontent.com/Alexlehoux974/Monster-Phone-Images/main/HIFUTURE/Images/Smartwatch/Sport-Pro/SMARTWATCH_SPORT.jpg',
      'Variantes/Couleurs': 'Noir sport, Blanc arctic',
      'Prix': 159.99,
      'Statut Publication': 'Publié'
    }
  ];

  // Extraire les marques et catégories uniques
  const brands = [...new Set(products.map(p => p.Marque))];
  const categories = [...new Set(products.map(p => p.Catégorie))];

  // Filtrer et trier les produits
  const filteredProducts = useMemo(() => {
    let filtered = products.filter(product => {
      const matchesSearch = product['Nom du Produit'].toLowerCase().includes(searchQuery.toLowerCase()) ||
                           product.Marque.toLowerCase().includes(searchQuery.toLowerCase());
      const matchesBrand = !selectedBrand || product.Marque === selectedBrand;
      const matchesCategory = !selectedCategory || product.Catégorie === selectedCategory;
      const matchesProduct = !selectedProduct || product['Nom du Produit'] === selectedProduct;
      
      return matchesSearch && matchesBrand && matchesCategory && matchesProduct;
    });

    // Trier les produits
    filtered.sort((a, b) => {
      switch (sortBy) {
        case 'price-asc':
          return a.Prix - b.Prix;
        case 'price-desc':
          return b.Prix - a.Prix;
        case 'name':
        default:
          return a['Nom du Produit'].localeCompare(b['Nom du Produit']);
      }
    });

    return filtered;
  }, [products, searchQuery, selectedBrand, selectedCategory, selectedProduct, sortBy]);

  const clearFilters = () => {
    setSearchQuery('');
    setSelectedBrand('');
    setSelectedCategory('');
    setSelectedProduct('');
    setSortBy('name');
  };

  const activeFiltersCount = [selectedBrand, selectedCategory, selectedProduct].filter(Boolean).length;

  return (
    <div className="min-h-screen bg-gray-50">
      <Header />
      
      <div className="flex">
        <Sidebar
          products={products}
          selectedCategory={selectedCategory}
          selectedBrand={selectedBrand}
          selectedProduct={selectedProduct}
          onCategoryChange={setSelectedCategory}
          onBrandChange={setSelectedBrand}
          onProductChange={setSelectedProduct}
          onClearFilters={clearFilters}
          isOpen={sidebarOpen}
          onClose={() => setSidebarOpen(false)}
        />
        
        <main className="flex-1 lg:ml-80 px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-8">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
            className="flex flex-col lg:flex-row lg:items-center lg:justify-between"
          >
            <div className="mb-4 lg:mb-0">
              <h1 className="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
                Nos Produits
              </h1>
              <p className="text-lg text-gray-600 max-w-2xl">
                Découvrez tous nos accessoires gaming et produits high-tech. 
                Plus de 500 références en stock pour sublimer votre expérience mobile.
              </p>
            </div>
            
            <Button
              variant="outline"
              onClick={() => setSidebarOpen(true)}
              className="lg:hidden mb-4"
            >
              <Menu className="w-4 h-4 mr-2" />
              Filtres {activeFiltersCount > 0 && `(${activeFiltersCount})`}
            </Button>
          </motion.div>
        </div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.1 }}
          className="bg-white rounded-lg shadow-sm border p-6 mb-8"
        >
          <div className="flex flex-col lg:flex-row gap-4">
            <div className="flex-1 relative">
              <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
              <input
                type="text"
                placeholder="Rechercher un produit, une marque..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
            
            <div className="flex gap-2">
              <select
                value={sortBy}
                onChange={(e) => setSortBy(e.target.value)}
                className="px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="name">Nom A-Z</option>
                <option value="price-asc">Prix croissant</option>
                <option value="price-desc">Prix décroissant</option>
              </select>
              
              <div className="flex border border-gray-300 rounded-lg">
                <button
                  onClick={() => setViewMode('grid')}
                  className={`p-3 ${viewMode === 'grid' ? 'bg-blue-500 text-white' : 'text-gray-600'}`}
                >
                  <Grid3X3 className="w-4 h-4" />
                </button>
                <button
                  onClick={() => setViewMode('list')}
                  className={`p-3 ${viewMode === 'list' ? 'bg-blue-500 text-white' : 'text-gray-600'}`}
                >
                  <List className="w-4 h-4" />
                </button>
              </div>
            </div>
          </div>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.2 }}
          className="flex items-center gap-4 mb-6"
        >
          <div className="flex items-center text-gray-600">
            <span className="font-medium text-gray-900">{filteredProducts.length}</span>
            <span className="ml-1">produit{filteredProducts.length > 1 ? 's' : ''} trouvé{filteredProducts.length > 1 ? 's' : ''}</span>
          </div>
        </motion.div>

        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 0.5, delay: 0.3 }}
        >
          {filteredProducts.length > 0 ? (
            <div className={
              viewMode === 'grid' 
                ? "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
                : "space-y-4"
            }>
              {filteredProducts.map((product, index) => (
                <motion.div
                  key={product.id}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.5, delay: index * 0.05 }}
                >
                  <ProductCard 
                    product={product} 
                    viewMode={viewMode}
                  />
                </motion.div>
              ))}
            </div>
          ) : (
            <div className="text-center py-16">
              <div className="text-gray-400 mb-4">
                <Search className="w-16 h-16 mx-auto" />
              </div>
              <h3 className="text-xl font-semibold text-gray-900 mb-2">
                Aucun produit trouvé
              </h3>
              <p className="text-gray-600 mb-4">
                Essayez de modifier vos critères de recherche
              </p>
              <Button onClick={clearFilters}>
                Effacer les filtres
              </Button>
            </div>
          )}
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.4 }}
          className="mt-16 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-8 text-center"
        >
          <h2 className="text-2xl md:text-3xl font-bold mb-4">
            Vous ne trouvez pas ce que vous cherchez ?
          </h2>
          <p className="text-lg mb-6 opacity-90">
            Notre équipe est là pour vous aider à trouver l'accessoire parfait
          </p>
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <Button variant="outline" className="bg-white text-blue-600 hover:bg-gray-50">
              Contacter un expert
            </Button>
            <Button variant="outline" className="border-white text-white hover:bg-white/10">
              Voir nos services
            </Button>
          </div>
        </motion.div>
      </main>

      <footer className="bg-gray-800 text-white py-8 mt-16">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
          <p>&copy; 2024 Monster Phone Boutique - Votre expert en telephonie mobile depuis 2018</p>
        </div>
      </footer>
    </div>
  );
}